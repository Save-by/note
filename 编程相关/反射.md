# 反射（框架设计的灵魂）

> 框架：半成品软件。可以在框架的基础上进行软件开发，简化编码。

## 概念

> 将类的各个组成部分封装成为其他对象，就是反射机制。
>
> **好处：**
>
> 1. 可以在程序运行过程中，操作这些对象。
>
> 2. 可以解耦，提高程序的可扩展性。

## 获取class的3种方式：

### Class.forName("全类名")    

将字节码加载进内存，返回Class对象

- 多用于配置文件，将类名定义在配置文件。读取文件，加载类

### 类名.class                              

通过类名的属性class获取

- 多用于参数的传递

### 对象.getClass()                      

getClass() 方法在Object类中定义着

- 多用于获取字节码的对象

### 结论

同一个字节码文件（*.class）在一次程序运行过程中，只会被加载一次（详因看类加载器篇）**所以以上3种获得的Class是同一个对象**





## Class对象的功能

### 获取功能

1. 获取成员变量（们）

   ```java
   Field[] getFields() //只获取所有public属性
   Field getField(String name)//只获取指定的public属性
       
   Field[] getDeclaredFields()//获取所有属性，不考虑修饰符
   Field getDeclaredField(String name)//获取指定的属性，不考虑修饰符
       
   //注意如果要访问私有属性，需要设置忽略访问权限修饰符的安全检查，否则会报异常（这里的d为私有属性）
   d.setAccessible(true);//也被称为暴力反射
   ```

2. 获取构造方法（们）

   ```java
   //适用范围同上
   Constructor<?>[] getConstructors()
   Constructor<T> getConstructor(Class<?>... parameterTypes)
       
   Constructor<?>[] getDeclaredConstructors()
   Constructor<T> getDeclaredConstructor(Class<?>... parameterTypes)
   ```

3. 获取成员方法（们）

   ```java
   //适用范围同上
   Method[] getMethods()
   Method getMethod(String name, Class<?>... parameterTypes)
       
   Method[] getDeclaredMethods()
   Method getDeclaredMethod(String name, Class<?>... parameterTypes)
   ```

4. 获取类名 

   ```java
   String getName()
   ```

### Field：成员变量

1. 设置值

   ``` java
   void set(Object obj,Object value)
   ```

   

2. 获取值

   ```java
   get(Object obj)
   ```

   

3. 忽略访问权限修饰符的安全检查

   ``` java
   setAccessible(true);//也被称为暴力反射
   ```

### Constructor：构造方法

1. 创建对象

   ```java
   T newInstance(Object... initargs)
       
   如果是构建空参的对象可以直接使用Class对象.newInstance()//已过时方法
   ```

### Method：成员方法

1. 执行方法

   ```java
   Object invoke(Object obj, Object... args)
   ```

   